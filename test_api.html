<!DOCTYPE html>
<html lang="zh-CN">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>CoinAPI.io 连接测试</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                max-width: 800px;
                margin: 0 auto;
                padding: 20px;
                background: #1a1a1a;
                color: #fff;
            }

            .test-section {
                background: #2a2a2a;
                padding: 20px;
                margin: 20px 0;
                border-radius: 8px;
                border: 1px solid #333;
            }

            .success {
                color: #28a745;
            }

            .error {
                color: #dc3545;
            }

            .info {
                color: #17a2b8;
            }

            button {
                background: #007bff;
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 4px;
                cursor: pointer;
                margin: 5px;
            }

            button:hover {
                background: #0056b3;
            }

            pre {
                background: #333;
                padding: 10px;
                border-radius: 4px;
                overflow-x: auto;
            }
        </style>
    </head>

    <body>
        <h1>CoinAPI.io 连接测试</h1>

        <div class="test-section">
            <h2>API 配置</h2>
            <p><strong>API Key:</strong> 2c318d13-0557-47a3-a5c2-93afdf223408</p>
            <p><strong>Base URL:</strong> https://rest.coinapi.io/v1</p>
            <button onclick="testConnection()">测试连接</button>
            <button onclick="testExchangeRates()">测试汇率</button>
            <button onclick="testSymbols()">测试交易对</button>
        </div>

        <div class="test-section">
            <h2>测试结果</h2>
            <div id="results"></div>
        </div>

        <script>
            const COINAPI_API_KEY = '2c318d13-0557-47a3-a5c2-93afdf223408';
            const COINAPI_BASE_URL = 'https://rest.coinapi.io/v1';

            function log(message, type = 'info') {
                const results = document.getElementById('results');
                const timestamp = new Date().toLocaleTimeString();
                const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
                results.innerHTML += `<p class="${className}">[${timestamp}] ${message}</p>`;
                results.scrollTop = results.scrollHeight;
            }

            async function testConnection() {
                log('开始测试CoinAPI.io连接...', 'info');

                try {
                    const response = await fetch(`${COINAPI_BASE_URL}/exchangerate/BTC/USDT`, {
                        headers: {
                            'X-CoinAPI-Key': COINAPI_API_KEY,
                            'Accept': 'application/json'
                        }
                    });

                    if (response.ok) {
                        const data = await response.json();
                        log(`连接成功！BTC/USDT 汇率: $${data.rate}`, 'success');
                        log(`响应数据: ${JSON.stringify(data, null, 2)}`, 'info');
                    } else {
                        log(`连接失败: ${response.status} ${response.statusText}`, 'error');
                    }
                } catch (error) {
                    log(`连接错误: ${error.message}`, 'error');
                }
            }

            async function testExchangeRates() {
                log('测试多个交易对汇率...', 'info');

                const symbols = ['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT'];

                for (const symbol of symbols) {
                    try {
                        const response = await fetch(`${COINAPI_BASE_URL}/exchangerate/${symbol}`, {
                            headers: {
                                'X-CoinAPI-Key': COINAPI_API_KEY,
                                'Accept': 'application/json'
                            }
                        });

                        if (response.ok) {
                            const data = await response.json();
                            log(`${symbol}: $${data.rate}`, 'success');
                        } else {
                            log(`${symbol}: 失败 - ${response.status}`, 'error');
                        }
                    } catch (error) {
                        log(`${symbol}: 错误 - ${error.message}`, 'error');
                    }

                    // 添加延迟避免请求过快
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
            }

            async function testSymbols() {
                log('测试获取可用交易对...', 'info');

                try {
                    const response = await fetch(`${COINAPI_BASE_URL}/symbols`, {
                        headers: {
                            'X-CoinAPI-Key': COINAPI_API_KEY,
                            'Accept': 'application/json'
                        }
                    });

                    if (response.ok) {
                        const data = await response.json();
                        log(`获取到 ${data.length} 个交易对`, 'success');

                        // 显示前10个交易对
                        const first10 = data.slice(0, 10);
                        log('前10个交易对:', 'info');
                        first10.forEach(symbol => {
                            log(`  ${symbol.symbol_id} (${symbol.asset_id_base}/${symbol.asset_id_quote})`, 'info');
                        });
                    } else {
                        log(`获取交易对失败: ${response.status} ${response.statusText}`, 'error');
                    }
                } catch (error) {
                    log(`获取交易对错误: ${error.message}`, 'error');
                }
            }

            // 页面加载时自动测试连接
            window.addEventListener('load', () => {
                log('页面加载完成，准备测试...', 'info');
            });
        </script>
    </body>

</html>
