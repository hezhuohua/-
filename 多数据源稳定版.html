<!DOCTYPE html>
<html lang="zh-CN">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Ê∞∏Áª≠ÂêàÁ∫¶È¢ÑÊµãÁ≥ªÁªü - Â§öÊï∞ÊçÆÊ∫êÁ®≥ÂÆöÁâà</title>
        <link href="https://cdn.jsdelivr.net/npm/element-plus@2.4.4/dist/index.css" rel="stylesheet">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

        <style>
            :root {
                --tech-blue: #00f3ff;
                --tech-bg: #0a0a1a;
                --tech-panel: #11112a;
                --tech-success: #28a745;
                --tech-danger: #dc3545;
                --tech-warning: #ffc107;
            }

            body {
                font-family: 'Exo 2', sans-serif;
                background: var(--tech-bg);
                color: white;
                margin: 0;
                padding: 20px;
                background-image:
                    radial-gradient(circle at 10% 20%, rgba(0, 243, 255, 0.1) 0%, transparent 20%),
                    radial-gradient(circle at 90% 80%, rgba(138, 43, 226, 0.1) 0%, transparent 20%);
                min-height: 100vh;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
            }

            .header {
                text-align: center;
                margin-bottom: 30px;
            }

            .header h1 {
                color: var(--tech-blue);
                font-size: 2.5rem;
                margin: 0;
                text-shadow: 0 0 20px rgba(0, 243, 255, 0.5);
            }

            .data-source-panel {
                background: var(--tech-panel);
                border: 1px solid var(--tech-blue);
                border-radius: 16px;
                padding: 20px;
                margin-bottom: 20px;
                box-shadow: 0 0 20px rgba(0, 243, 255, 0.3);
            }

            .data-source-status {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 15px;
                margin-bottom: 20px;
            }

            .source-item {
                background: rgba(0, 243, 255, 0.1);
                border: 1px solid rgba(0, 243, 255, 0.3);
                border-radius: 8px;
                padding: 15px;
                transition: all 0.3s ease;
            }

            .source-item.active {
                border-color: var(--tech-success);
                box-shadow: 0 0 10px rgba(40, 167, 69, 0.5);
            }

            .source-item.error {
                border-color: var(--tech-danger);
                box-shadow: 0 0 10px rgba(220, 53, 69, 0.5);
            }

            .source-item.warning {
                border-color: var(--tech-warning);
                box-shadow: 0 0 10px rgba(255, 193, 7, 0.5);
            }

            .source-name {
                font-weight: bold;
                margin-bottom: 5px;
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .source-status {
                font-size: 0.9rem;
                opacity: 0.8;
            }

            .price-panel {
                background: var(--tech-panel);
                border: 1px solid var(--tech-blue);
                border-radius: 16px;
                padding: 20px;
                margin-bottom: 20px;
                box-shadow: 0 0 20px rgba(0, 243, 255, 0.3);
            }

            .price-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
            }

            .price-item {
                background: rgba(0, 243, 255, 0.1);
                border: 1px solid rgba(0, 243, 255, 0.3);
                border-radius: 8px;
                padding: 15px;
                text-align: center;
            }

            .price-symbol {
                font-weight: bold;
                color: var(--tech-blue);
                margin-bottom: 5px;
            }

            .price-value {
                font-size: 1.5rem;
                font-weight: bold;
                margin-bottom: 5px;
            }

            .price-change {
                font-size: 0.9rem;
            }

            .price-change.positive {
                color: var(--tech-success);
            }

            .price-change.negative {
                color: var(--tech-danger);
            }

            .controls {
                text-align: center;
                margin: 20px 0;
            }

            .btn {
                background: var(--tech-panel);
                border: 1px solid var(--tech-blue);
                color: var(--tech-blue);
                padding: 10px 20px;
                margin: 5px;
                border-radius: 8px;
                cursor: pointer;
                transition: all 0.3s ease;
            }

            .btn:hover {
                background: rgba(0, 243, 255, 0.2);
                box-shadow: 0 0 15px rgba(0, 243, 255, 0.7);
            }

            .notification {
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                z-index: 1000;
                transition: all 0.3s ease;
                max-width: 300px;
            }

            .notification.success {
                background: var(--tech-success);
                border: 1px solid rgba(40, 167, 69, 0.5);
            }

            .notification.error {
                background: var(--tech-danger);
                border: 1px solid rgba(220, 53, 69, 0.5);
            }

            .notification.info {
                background: var(--tech-blue);
                border: 1px solid rgba(0, 243, 255, 0.5);
            }

            .notification.warning {
                background: var(--tech-warning);
                border: 1px solid rgba(255, 193, 7, 0.5);
                color: #000;
            }

            .log-panel {
                background: var(--tech-panel);
                border: 1px solid var(--tech-blue);
                border-radius: 16px;
                padding: 20px;
                margin-top: 20px;
                max-height: 300px;
                overflow-y: auto;
            }

            .log-entry {
                font-family: monospace;
                font-size: 0.9rem;
                margin-bottom: 5px;
                padding: 5px;
                border-left: 3px solid var(--tech-blue);
                padding-left: 10px;
            }

            .log-entry.error {
                border-left-color: var(--tech-danger);
                background: rgba(220, 53, 69, 0.1);
            }

            .log-entry.success {
                border-left-color: var(--tech-success);
                background: rgba(40, 167, 69, 0.1);
            }

            .log-entry.warning {
                border-left-color: var(--tech-warning);
                background: rgba(255, 193, 7, 0.1);
            }
        </style>
    </head>

    <body>
        <div class="container">
            <div class="header">
                <h1>üöÄ Ê∞∏Áª≠ÂêàÁ∫¶È¢ÑÊµãÁ≥ªÁªü</h1>
                <p>Â§öÊï∞ÊçÆÊ∫êÁ®≥ÂÆöÁâà - 2025Âπ¥ÊúÄÊñ∞</p>
            </div>

            <div class="data-source-panel">
                <h3><i class="fas fa-database"></i> Êï∞ÊçÆÊ∫êÁä∂ÊÄÅÁõëÊéß</h3>
                <div class="data-source-status" id="dataSourceStatus">
                    <!-- Êï∞ÊçÆÊ∫êÁä∂ÊÄÅÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                </div>
                <div>
                    <strong>ÂΩìÂâçÊ¥ªË∑ÉÊï∞ÊçÆÊ∫êÔºö</strong>
                    <span id="currentDataSource" style="color: var(--tech-success);">ÂàùÂßãÂåñ‰∏≠...</span>
                </div>
            </div>

            <div class="price-panel">
                <h3><i class="fas fa-chart-line"></i> ÂÆûÊó∂‰ª∑Ê†ºÊï∞ÊçÆ</h3>
                <div class="price-grid" id="priceGrid">
                    <!-- ‰ª∑Ê†ºÊï∞ÊçÆÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                </div>
            </div>

            <div class="controls">
                <button class="btn" onclick="testAllDataSources()">
                    <i class="fas fa-test-tube"></i> ÊµãËØïÊâÄÊúâÊï∞ÊçÆÊ∫ê
                </button>
                <button class="btn" onclick="forceRefresh()">
                    <i class="fas fa-refresh"></i> Âº∫Âà∂Âà∑Êñ∞
                </button>
                <button class="btn" onclick="switchToNextSource()">
                    <i class="fas fa-exchange-alt"></i> ÂàáÊç¢Êï∞ÊçÆÊ∫ê
                </button>
                <button class="btn" onclick="clearLogs()">
                    <i class="fas fa-eraser"></i> Ê∏ÖÁ©∫Êó•Âøó
                </button>
            </div>

            <div class="log-panel">
                <h3><i class="fas fa-terminal"></i> Á≥ªÁªüÊó•Âøó</h3>
                <div id="logContainer">
                    <!-- Êó•ÂøóÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫ -->
                </div>
            </div>
        </div>

        <script>
            // Â§öÊï∞ÊçÆÊ∫êÈÖçÁΩÆ - 2025Âπ¥ÊúÄÁ®≥ÂÆöÁöÑÊï∞ÊçÆÊ∫ê
            const DATA_SOURCES = {
                coinapi: {
                    name: 'CoinAPI.io',
                    priority: 1,
                    baseUrl: 'https://rest.coinapi.io/v1',
                    apiKey: '', // ÈúÄË¶ÅÊ≥®ÂÜåËé∑ÂèñÂÖçË¥πAPI Key
                    rateLimit: 100, // ÂÖçË¥πÁâàÊØèÊó•100Ê¨°
                    status: 'unknown',
                    lastSuccess: null,
                    errorCount: 0,
                    description: '‰∏ì‰∏öÁ∫ßAPIÔºå99.9%ÂèØÁî®ÊÄß'
                },
                alphavantage: {
                    name: 'Alpha Vantage',
                    priority: 2,
                    baseUrl: 'https://www.alphavantage.co/query',
                    apiKey: 'demo', // ‰ΩøÁî®demo keyËøõË°åÊµãËØï
                    rateLimit: 500, // ÂÖçË¥πÁâàÊØèÊó•500Ê¨°
                    status: 'unknown',
                    lastSuccess: null,
                    errorCount: 0,
                    description: '2025Âπ¥ÊúÄ‰Ω≥ÁªºÂêàÊï∞ÊçÆÊ∫ê'
                },
                coinpaprika: {
                    name: 'CoinPaprika',
                    priority: 3,
                    baseUrl: 'https://api.coinpaprika.com/v1',
                    apiKey: null, // ÂÖçË¥πÊó†ÈúÄAPI Key
                    rateLimit: 2000, // ÂÖçË¥πÁâàÊØèÊó•2000Ê¨°
                    status: 'unknown',
                    lastSuccess: null,
                    errorCount: 0,
                    description: 'Áã¨Á´ãÊï∞ÊçÆËÅöÂêàÂïÜÔºå54K+ËµÑ‰∫ß'
                },
                coingecko: {
                    name: 'CoinGecko',
                    priority: 4,
                    baseUrl: 'https://api.coingecko.com/api/v3',
                    apiKey: null, // ÂÖçË¥πÊó†ÈúÄAPI Key
                    rateLimit: 1000, // ÂÖçË¥πÁâàÈôêÂà∂ËæÉ‰Ωé
                    status: 'unknown',
                    lastSuccess: null,
                    errorCount: 0,
                    description: '‰º†ÁªüÊï∞ÊçÆÊ∫êÔºåÂ§áÁî®ÈÄâÊã©'
                },
                binance: {
                    name: 'Binance API',
                    priority: 5,
                    baseUrl: 'https://api.binance.com/api/v3',
                    apiKey: null, // ÂÖ¨ÂºÄÊï∞ÊçÆÊó†ÈúÄAPI Key
                    rateLimit: 1200, // ÊùÉÈáçÈôêÂà∂
                    status: 'unknown',
                    lastSuccess: null,
                    errorCount: 0,
                    description: 'ÂÆòÊñπÊï∞ÊçÆÔºåÊúÄÊùÉÂ®Å'
                }
            };

            // ÊîØÊåÅÁöÑ‰∫§ÊòìÂØπ
            const TRADING_PAIRS = ['BTC/USD', 'ETH/USD', 'BNB/USD', 'ADA/USD', 'SOL/USD', 'XRP/USD', 'DOGE/USD', 'AVAX/USD'];

            // ÂΩìÂâçÊ¥ªË∑ÉÁöÑÊï∞ÊçÆÊ∫ê
            let currentDataSource = null;
            let priceData = {};
            let updateInterval = null;
            let logContainer = document.getElementById('logContainer');

            // Êó•ÂøóËÆ∞ÂΩïÂáΩÊï∞
            function addLog(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = document.createElement('div');
                logEntry.className = `log-entry ${type}`;
                logEntry.innerHTML = `[${timestamp}] ${message}`;
                logContainer.insertBefore(logEntry, logContainer.firstChild);

                // ÈôêÂà∂Êó•ÂøóÊù°Êï∞
                if (logContainer.children.length > 100) {
                    logContainer.removeChild(logContainer.lastChild);
                }

                console.log(`[${type.toUpperCase()}] ${message}`);
            }

            // ÊòæÁ§∫ÈÄöÁü•
            function showNotification(message, type = 'info', duration = 5000) {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.innerHTML = `<i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation-triangle' : 'info'}"></i> ${message}`;
                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.style.opacity = '0';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }, duration);
            }

            // Êõ¥Êñ∞Êï∞ÊçÆÊ∫êÁä∂ÊÄÅÊòæÁ§∫
            function updateDataSourceStatus() {
                const container = document.getElementById('dataSourceStatus');
                container.innerHTML = '';

                Object.entries(DATA_SOURCES).forEach(([key, source]) => {
                    const item = document.createElement('div');
                    item.className = `source-item ${source.status}`;

                    const statusIcon = source.status === 'active' ? 'check-circle' :
                        source.status === 'error' ? 'exclamation-circle' :
                            source.status === 'warning' ? 'exclamation-triangle' : 'question-circle';

                    const statusColor = source.status === 'active' ? 'var(--tech-success)' :
                        source.status === 'error' ? 'var(--tech-danger)' :
                            source.status === 'warning' ? 'var(--tech-warning)' : 'var(--tech-blue)';

                    item.innerHTML = `
                    <div class="source-name">
                        <i class="fas fa-${statusIcon}" style="color: ${statusColor}"></i>
                        ${source.name}
                        ${key === currentDataSource ? '<span style="color: var(--tech-success);">[Ê¥ªË∑É]</span>' : ''}
                    </div>
                    <div class="source-status">
                        ‰ºòÂÖàÁ∫ß: ${source.priority} | ÈîôËØØÊ¨°Êï∞: ${source.errorCount}<br>
                        ${source.description}<br>
                        ${source.lastSuccess ? `ÊúÄÂêéÊàêÂäü: ${new Date(source.lastSuccess).toLocaleTimeString()}` : 'Êú™ËøûÊé•'}
                    </div>
                `;
                    container.appendChild(item);
                });

                // Êõ¥Êñ∞ÂΩìÂâçÊï∞ÊçÆÊ∫êÊòæÁ§∫
                document.getElementById('currentDataSource').textContent =
                    currentDataSource ? DATA_SOURCES[currentDataSource].name : 'Êó†';
            }

            // CoinPaprikaÊï∞ÊçÆËé∑Âèñ
            async function fetchCoinPaprikaData() {
                try {
                    addLog('Â∞ùËØïËøûÊé•CoinPaprikaÊï∞ÊçÆÊ∫ê...', 'info');

                    // CoinPaprikaÁöÑtickerÊï∞ÊçÆ
                    const response = await fetch(`${DATA_SOURCES.coinpaprika.baseUrl}/tickers?limit=10`);

                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }

                    const data = await response.json();
                    const prices = {};

                    // Êò†Â∞ÑÂ∏∏ËßÅÂ∏ÅÁßç
                    const symbolMap = {
                        'btc-bitcoin': 'BTC/USD',
                        'eth-ethereum': 'ETH/USD',
                        'bnb-binance-coin': 'BNB/USD',
                        'ada-cardano': 'ADA/USD',
                        'sol-solana': 'SOL/USD',
                        'xrp-xrp': 'XRP/USD',
                        'doge-dogecoin': 'DOGE/USD',
                        'avax-avalanche': 'AVAX/USD'
                    };

                    data.forEach(coin => {
                        const symbol = symbolMap[coin.id];
                        if (symbol && coin.quotes && coin.quotes.USD) {
                            prices[symbol] = {
                                price: coin.quotes.USD.price,
                                change24h: coin.quotes.USD.percent_change_24h,
                                timestamp: new Date().toISOString()
                            };
                        }
                    });

                    if (Object.keys(prices).length === 0) {
                        throw new Error('Êú™Ëé∑ÂèñÂà∞ÊúâÊïàÁöÑ‰ª∑Ê†ºÊï∞ÊçÆ');
                    }

                    DATA_SOURCES.coinpaprika.status = 'active';
                    DATA_SOURCES.coinpaprika.lastSuccess = Date.now();
                    DATA_SOURCES.coinpaprika.errorCount = 0;

                    addLog(`CoinPaprikaÊï∞ÊçÆËé∑ÂèñÊàêÂäüÔºåËé∑ÂèñÂà∞${Object.keys(prices).length}‰∏™‰∫§ÊòìÂØπÊï∞ÊçÆ`, 'success');
                    return prices;

                } catch (error) {
                    DATA_SOURCES.coinpaprika.status = 'error';
                    DATA_SOURCES.coinpaprika.errorCount++;
                    addLog(`CoinPaprikaËøûÊé•Â§±Ë¥•: ${error.message}`, 'error');
                    throw error;
                }
            }

            // CoinGeckoÊï∞ÊçÆËé∑Âèñ
            async function fetchCoinGeckoData() {
                try {
                    addLog('Â∞ùËØïËøûÊé•CoinGeckoÊï∞ÊçÆÊ∫ê...', 'info');

                    const coinIds = 'bitcoin,ethereum,binancecoin,cardano,solana,ripple,dogecoin,avalanche-2';
                    const url = `${DATA_SOURCES.coingecko.baseUrl}/simple/price?ids=${coinIds}&vs_currencies=usd&include_24hr_change=true`;

                    const response = await fetch(url);

                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }

                    const data = await response.json();
                    const prices = {};

                    // Êò†Â∞ÑÂ∏ÅÁßçIDÂà∞‰∫§ÊòìÂØπ
                    const idMap = {
                        'bitcoin': 'BTC/USD',
                        'ethereum': 'ETH/USD',
                        'binancecoin': 'BNB/USD',
                        'cardano': 'ADA/USD',
                        'solana': 'SOL/USD',
                        'ripple': 'XRP/USD',
                        'dogecoin': 'DOGE/USD',
                        'avalanche-2': 'AVAX/USD'
                    };

                    Object.entries(data).forEach(([coinId, coinData]) => {
                        const symbol = idMap[coinId];
                        if (symbol && coinData.usd) {
                            prices[symbol] = {
                                price: coinData.usd,
                                change24h: coinData.usd_24h_change || 0,
                                timestamp: new Date().toISOString()
                            };
                        }
                    });

                    if (Object.keys(prices).length === 0) {
                        throw new Error('Êú™Ëé∑ÂèñÂà∞ÊúâÊïàÁöÑ‰ª∑Ê†ºÊï∞ÊçÆ');
                    }

                    DATA_SOURCES.coingecko.status = 'active';
                    DATA_SOURCES.coingecko.lastSuccess = Date.now();
                    DATA_SOURCES.coingecko.errorCount = 0;

                    addLog(`CoinGeckoÊï∞ÊçÆËé∑ÂèñÊàêÂäüÔºåËé∑ÂèñÂà∞${Object.keys(prices).length}‰∏™‰∫§ÊòìÂØπÊï∞ÊçÆ`, 'success');
                    return prices;

                } catch (error) {
                    DATA_SOURCES.coingecko.status = 'error';
                    DATA_SOURCES.coingecko.errorCount++;
                    addLog(`CoinGeckoËøûÊé•Â§±Ë¥•: ${error.message}`, 'error');
                    throw error;
                }
            }

            // BinanceÊï∞ÊçÆËé∑Âèñ
            async function fetchBinanceData() {
                try {
                    addLog('Â∞ùËØïËøûÊé•BinanceÊï∞ÊçÆÊ∫ê...', 'info');

                    const response = await fetch(`${DATA_SOURCES.binance.baseUrl}/ticker/24hr`);

                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }

                    const data = await response.json();
                    const prices = {};

                    // ËøáÊª§Êàë‰ª¨ÈúÄË¶ÅÁöÑ‰∫§ÊòìÂØπ
                    const symbolMap = {
                        'BTCUSDT': 'BTC/USD',
                        'ETHUSDT': 'ETH/USD',
                        'BNBUSDT': 'BNB/USD',
                        'ADAUSDT': 'ADA/USD',
                        'SOLUSDT': 'SOL/USD',
                        'XRPUSDT': 'XRP/USD',
                        'DOGEUSDT': 'DOGE/USD',
                        'AVAXUSDT': 'AVAX/USD'
                    };

                    data.forEach(ticker => {
                        const symbol = symbolMap[ticker.symbol];
                        if (symbol) {
                            prices[symbol] = {
                                price: parseFloat(ticker.lastPrice),
                                change24h: parseFloat(ticker.priceChangePercent),
                                timestamp: new Date().toISOString()
                            };
                        }
                    });

                    if (Object.keys(prices).length === 0) {
                        throw new Error('Êú™Ëé∑ÂèñÂà∞ÊúâÊïàÁöÑ‰ª∑Ê†ºÊï∞ÊçÆ');
                    }

                    DATA_SOURCES.binance.status = 'active';
                    DATA_SOURCES.binance.lastSuccess = Date.now();
                    DATA_SOURCES.binance.errorCount = 0;

                    addLog(`BinanceÊï∞ÊçÆËé∑ÂèñÊàêÂäüÔºåËé∑ÂèñÂà∞${Object.keys(prices).length}‰∏™‰∫§ÊòìÂØπÊï∞ÊçÆ`, 'success');
                    return prices;

                } catch (error) {
                    DATA_SOURCES.binance.status = 'error';
                    DATA_SOURCES.binance.errorCount++;
                    addLog(`BinanceËøûÊé•Â§±Ë¥•: ${error.message}`, 'error');
                    throw error;
                }
            }

            // ÁîüÊàêÊ®°ÊãüÊï∞ÊçÆÔºàÊúÄÂêéÂ§áÁî®ÊñπÊ°àÔºâ
            function generateSimulatedData() {
                addLog('‰ΩøÁî®Ê®°ÊãüÊï∞ÊçÆ‰Ωú‰∏∫Â§áÁî®ÊñπÊ°à', 'warning');

                const baseData = {
                    'BTC/USD': { price: 43250.00, change24h: 2.45 },
                    'ETH/USD': { price: 2680.50, change24h: -1.23 },
                    'BNB/USD': { price: 315.75, change24h: 1.87 },
                    'ADA/USD': { price: 0.485, change24h: 3.21 },
                    'SOL/USD': { price: 98.45, change24h: -0.95 },
                    'XRP/USD': { price: 0.625, change24h: 1.65 },
                    'DOGE/USD': { price: 0.085, change24h: 4.32 },
                    'AVAX/USD': { price: 36.75, change24h: -2.14 }
                };

                const simulatedData = {};
                Object.entries(baseData).forEach(([symbol, data]) => {
                    // Ê∑ªÂä†ÈöèÊú∫Ê≥¢Âä®
                    const priceVariation = (Math.random() - 0.5) * 0.02; // ¬±1%ÁöÑÈöèÊú∫Ê≥¢Âä®
                    const changeVariation = (Math.random() - 0.5) * 2; // ¬±1%ÁöÑÂèòÂåñÊ≥¢Âä®

                    simulatedData[symbol] = {
                        price: data.price * (1 + priceVariation),
                        change24h: data.change24h + changeVariation,
                        timestamp: new Date().toISOString()
                    };
                });

                return simulatedData;
            }

            // Êô∫ËÉΩÊï∞ÊçÆÊ∫êÈÄâÊã©Âô®
            async function fetchDataFromBestSource() {
                // Êåâ‰ºòÂÖàÁ∫ßÊéíÂ∫èÂèØÁî®ÁöÑÊï∞ÊçÆÊ∫ê
                const sortedSources = Object.entries(DATA_SOURCES)
                    .filter(([key, source]) => source.errorCount < 5) // ËøáÊª§ÈîôËØØËøáÂ§öÁöÑÊ∫ê
                    .sort((a, b) => a[1].priority - b[1].priority);

                for (const [sourceKey, sourceConfig] of sortedSources) {
                    try {
                        let data = null;

                        switch (sourceKey) {
                            case 'coinpaprika':
                                data = await fetchCoinPaprikaData();
                                break;
                            case 'coingecko':
                                data = await fetchCoinGeckoData();
                                break;
                            case 'binance':
                                data = await fetchBinanceData();
                                break;
                            // Ê≥®ÊÑèÔºöCoinAPIÂíåAlpha VantageÈúÄË¶ÅAPI KeyÊâçËÉΩÊ≠£Â∏∏‰ΩøÁî®
                            default:
                                continue;
                        }

                        if (data && Object.keys(data).length > 0) {
                            currentDataSource = sourceKey;
                            priceData = data;
                            addLog(`ÊàêÂäüÂàáÊç¢Âà∞Êï∞ÊçÆÊ∫ê: ${sourceConfig.name}`, 'success');
                            return data;
                        }

                    } catch (error) {
                        addLog(`Êï∞ÊçÆÊ∫ê ${sourceConfig.name} Â§±Ë¥•ÔºåÂ∞ùËØï‰∏ã‰∏Ä‰∏™...`, 'warning');
                        continue;
                    }
                }

                // Â¶ÇÊûúÊâÄÊúâÊï∞ÊçÆÊ∫êÈÉΩÂ§±Ë¥•Ôºå‰ΩøÁî®Ê®°ÊãüÊï∞ÊçÆ
                addLog('ÊâÄÊúâÊï∞ÊçÆÊ∫êÂùá‰∏çÂèØÁî®Ôºå‰ΩøÁî®Ê®°ÊãüÊï∞ÊçÆ', 'warning');
                priceData = generateSimulatedData();
                currentDataSource = null;
                return priceData;
            }

            // Êõ¥Êñ∞‰ª∑Ê†ºÊòæÁ§∫
            function updatePriceDisplay() {
                const container = document.getElementById('priceGrid');
                container.innerHTML = '';

                Object.entries(priceData).forEach(([symbol, data]) => {
                    const item = document.createElement('div');
                    item.className = 'price-item';

                    const changeClass = data.change24h >= 0 ? 'positive' : 'negative';
                    const changeIcon = data.change24h >= 0 ? '‚Üó' : '‚Üò';

                    item.innerHTML = `
                    <div class="price-symbol">${symbol}</div>
                    <div class="price-value">$${data.price.toLocaleString('en-US', {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: data.price < 1 ? 6 : 2
                    })}</div>
                    <div class="price-change ${changeClass}">
                        ${changeIcon} ${data.change24h.toFixed(2)}%
                    </div>
                `;
                    container.appendChild(item);
                });
            }

            // ‰∏ªË¶ÅÁöÑÊï∞ÊçÆÊõ¥Êñ∞ÂáΩÊï∞
            async function updateData() {
                try {
                    addLog('ÂºÄÂßãÊï∞ÊçÆÊõ¥Êñ∞...', 'info');
                    await fetchDataFromBestSource();
                    updatePriceDisplay();
                    updateDataSourceStatus();
                    addLog('Êï∞ÊçÆÊõ¥Êñ∞ÂÆåÊàê', 'success');
                } catch (error) {
                    addLog(`Êï∞ÊçÆÊõ¥Êñ∞Â§±Ë¥•: ${error.message}`, 'error');
                    showNotification('Êï∞ÊçÆÊõ¥Êñ∞Â§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•', 'error');
                }
            }

            // ÊµãËØïÊâÄÊúâÊï∞ÊçÆÊ∫ê
            async function testAllDataSources() {
                addLog('ÂºÄÂßãÊµãËØïÊâÄÊúâÊï∞ÊçÆÊ∫ê...', 'info');
                showNotification('Ê≠£Âú®ÊµãËØïÊâÄÊúâÊï∞ÊçÆÊ∫ê...', 'info');

                const testPromises = Object.entries(DATA_SOURCES).map(async ([key, source]) => {
                    try {
                        switch (key) {
                            case 'coinpaprika':
                                await fetchCoinPaprikaData();
                                break;
                            case 'coingecko':
                                await fetchCoinGeckoData();
                                break;
                            case 'binance':
                                await fetchBinanceData();
                                break;
                            default:
                                DATA_SOURCES[key].status = 'warning';
                                addLog(`${source.name}: ÈúÄË¶ÅAPI KeyÔºåË∑≥ËøáÊµãËØï`, 'warning');
                        }
                    } catch (error) {
                        // ÈîôËØØÂ∑≤Âú®ÂêÑËá™ÁöÑfetchÂáΩÊï∞‰∏≠Â§ÑÁêÜ
                    }
                });

                await Promise.allSettled(testPromises);
                updateDataSourceStatus();

                const activeSources = Object.values(DATA_SOURCES).filter(s => s.status === 'active').length;
                addLog(`Êï∞ÊçÆÊ∫êÊµãËØïÂÆåÊàêÔºå${activeSources}‰∏™Êï∞ÊçÆÊ∫êÂèØÁî®`, 'success');
                showNotification(`ÊµãËØïÂÆåÊàêÔºå${activeSources}‰∏™Êï∞ÊçÆÊ∫êÂèØÁî®`, 'success');
            }

            // Âº∫Âà∂Âà∑Êñ∞
            async function forceRefresh() {
                addLog('ÊâßË°åÂº∫Âà∂Âà∑Êñ∞...', 'info');
                showNotification('Ê≠£Âú®Âº∫Âà∂Âà∑Êñ∞Êï∞ÊçÆ...', 'info');
                await updateData();
            }

            // ÂàáÊç¢Âà∞‰∏ã‰∏Ä‰∏™Êï∞ÊçÆÊ∫ê
            async function switchToNextSource() {
                const currentIndex = Object.keys(DATA_SOURCES).indexOf(currentDataSource);
                const nextIndex = (currentIndex + 1) % Object.keys(DATA_SOURCES).length;
                const nextSourceKey = Object.keys(DATA_SOURCES)[nextIndex];

                addLog(`Â∞ùËØïÂàáÊç¢Âà∞Êï∞ÊçÆÊ∫ê: ${DATA_SOURCES[nextSourceKey].name}`, 'info');

                // ÈáçÁΩÆÂΩìÂâçÊï∞ÊçÆÊ∫êÁä∂ÊÄÅ
                if (currentDataSource) {
                    DATA_SOURCES[currentDataSource].status = 'unknown';
                }

                await updateData();
            }

            // Ê∏ÖÁ©∫Êó•Âøó
            function clearLogs() {
                logContainer.innerHTML = '';
                addLog('Êó•ÂøóÂ∑≤Ê∏ÖÁ©∫', 'info');
            }

            // ÂàùÂßãÂåñÁ≥ªÁªü
            async function initializeSystem() {
                addLog('=== Ê∞∏Áª≠ÂêàÁ∫¶È¢ÑÊµãÁ≥ªÁªüÂêØÂä® ===', 'info');
                addLog('Â§öÊï∞ÊçÆÊ∫êÁ®≥ÂÆöÁâà - 2025Âπ¥ÊúÄÊñ∞', 'info');

                showNotification('Á≥ªÁªüÊ≠£Âú®ÂàùÂßãÂåñ...', 'info');

                // ÂàùÂßãÂåñÊï∞ÊçÆÊ∫êÁä∂ÊÄÅ
                updateDataSourceStatus();

                // ËøõË°åÂàùÂßãÊï∞ÊçÆËé∑Âèñ
                await updateData();

                // ËÆæÁΩÆÂÆöÊó∂Êõ¥Êñ∞ÔºàÊØè30ÁßíÔºâ
                if (updateInterval) clearInterval(updateInterval);
                updateInterval = setInterval(updateData, 30000);

                addLog('Á≥ªÁªüÂàùÂßãÂåñÂÆåÊàêÔºåÊØè30ÁßíËá™Âä®Êõ¥Êñ∞Êï∞ÊçÆ', 'success');
                showNotification('Á≥ªÁªüÂàùÂßãÂåñÂÆåÊàêÔºÅ', 'success');
            }

            // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂêØÂä®Á≥ªÁªü
            document.addEventListener('DOMContentLoaded', initializeSystem);

            // È°µÈù¢Âç∏ËΩΩÊó∂Ê∏ÖÁêÜ
            window.addEventListener('beforeunload', () => {
                if (updateInterval) {
                    clearInterval(updateInterval);
                }
            });

            // ÁΩëÁªúÁä∂ÊÄÅÁõëÊéß
            window.addEventListener('online', () => {
                addLog('ÁΩëÁªúËøûÊé•Â∑≤ÊÅ¢Â§ç', 'success');
                showNotification('ÁΩëÁªúËøûÊé•Â∑≤ÊÅ¢Â§ç', 'success');
                updateData();
            });

            window.addEventListener('offline', () => {
                addLog('ÁΩëÁªúËøûÊé•‰∏≠Êñ≠ÔºåÂ∞Ü‰ΩøÁî®ÁºìÂ≠òÊï∞ÊçÆ', 'warning');
                showNotification('ÁΩëÁªúËøûÊé•‰∏≠Êñ≠', 'warning');
            });
        </script>
    </body>

</html>
