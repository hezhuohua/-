# 🚀 币安代理交易系统部署指南

## 📋 部署前准备

### 系统要求

- **操作系统**: Windows 10/11, macOS, Linux
- **Python**: 3.8 或更高版本
- **内存**: 至少 4GB RAM
- **存储**: 至少 1GB 可用空间
- **网络**: 稳定的互联网连接

### 环境检查

```bash
# 检查Python版本
python --version

# 检查pip版本
pip --version

# 检查网络连接
ping api.binance.com
```

## 🔧 快速部署

### 方式一：一键启动（推荐）

1. **下载项目文件**
   - 确保所有文件在同一目录下

2. **运行启动脚本**
   ```bash
   # Windows
   启动系统.bat

   # Linux/macOS
   chmod +x 启动系统.sh
   ./启动系统.sh
   ```

3. **访问系统**
   - 后端API: http://localhost:5000
   - 前端界面: http://localhost:8080/币安代理交易系统.html

### 方式二：手动部署

#### 1. 安装依赖

```bash
# 安装Python依赖
pip install -r requirements.txt

# 验证安装
python -c "import flask, requests, schedule; print('依赖安装成功')"
```

#### 2. 启动后端服务

```bash
# 启动后端API服务
python start_server.py
```

#### 3. 启动前端服务

```bash
# 新开一个终端窗口
python -m http.server 8080
```

#### 4. 访问系统

- 打开浏览器访问: http://localhost:8080/币安代理交易系统.html

## 🔒 生产环境部署

### 1. 环境变量配置

```bash
# 设置生产环境变量
export FLASK_ENV=production
export SECRET_KEY=your-super-secret-key-here
export API_KEY_ENCRYPTION_KEY=your-encryption-key-here
export DEBUG=False
export LOG_LEVEL=WARNING
```

### 2. 使用Gunicorn部署

```bash
# 安装Gunicorn
pip install gunicorn

# 启动服务
gunicorn -w 4 -b 0.0.0.0:5000 start_server:app
```

### 3. 使用Nginx反向代理

```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    location /static/ {
        alias /path/to/your/static/files/;
    }
}
```

### 4. 使用Docker部署

```dockerfile
FROM python:3.9-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install -r requirements.txt

COPY . .

EXPOSE 5000

CMD ["python", "start_server.py"]
```

```bash
# 构建镜像
docker build -t binance-trading-system .

# 运行容器
docker run -d -p 5000:5000 --name trading-system binance-trading-system
```

## 🔧 配置说明

### 数据库配置

系统使用SQLite数据库，文件位置：
- 开发环境: `trading_system.db`
- 生产环境: 可通过环境变量 `DATABASE_PATH` 指定

### 日志配置

```python
# 日志文件位置
LOG_FILE = 'trading_system.log'

# 日志级别
LOG_LEVEL = 'INFO'  # DEBUG, INFO, WARNING, ERROR

# 日志轮转
LOG_MAX_SIZE = 10 * 1024 * 1024  # 10MB
LOG_BACKUP_COUNT = 5
```

### 币安API配置

1. **创建API Key**
   - 登录币安官网
   - 进入API管理页面
   - 创建新的API Key

2. **权限设置**
   - ✅ 启用现货及杠杆交易
   - ✅ 启用合约交易
   - ✅ 启用读取信息
   - ❌ **禁用提现**（重要！）

3. **安全设置**
   - 设置IP白名单
   - 启用交易密码
   - 定期更换API Key

## 🧪 系统测试

### 运行测试脚本

```bash
# 运行完整测试
python test_system.py

# 选择测试类型
# 1. 后端API测试
# 2. 前端功能测试
# 3. 完整系统测试
```

### 手动测试

1. **API连接测试**
   ```bash
   curl -X POST http://localhost:5000/api/test \
     -H "Content-Type: application/json" \
     -d '{"user_id": "test_user"}'
   ```

2. **配置保存测试**
   ```bash
   curl -X POST http://localhost:5000/api/config \
     -H "Content-Type: application/json" \
     -d '{
       "user_id": "test_user",
       "api_key": "your_api_key",
       "api_secret": "your_api_secret",
       "testnet": true
     }'
   ```

## 🔍 故障排除

### 常见问题

#### 1. 端口被占用

```bash
# 查看端口占用
netstat -ano | findstr :5000

# 结束占用进程
taskkill /PID <进程ID> /F

# 使用其他端口
export PORT=5001
python start_server.py
```

#### 2. 依赖安装失败

```bash
# 升级pip
python -m pip install --upgrade pip

# 清除缓存
pip cache purge

# 重新安装
pip install -r requirements.txt --force-reinstall
```

#### 3. 数据库错误

```bash
# 删除数据库文件重新初始化
rm trading_system.db
python start_server.py
```

#### 4. API连接失败

- 检查网络连接
- 确认币安API Key有效
- 检查API权限设置
- 验证IP白名单

### 日志查看

```bash
# 查看实时日志
tail -f trading_system.log

# 查看错误日志
grep ERROR trading_system.log

# 查看最近日志
tail -n 100 trading_system.log
```

## 🔒 安全建议

### 1. 服务器安全

- 使用HTTPS
- 配置防火墙
- 定期更新系统
- 使用强密码

### 2. API安全

- 定期更换API Key
- 设置IP白名单
- 禁用提现权限
- 监控异常活动

### 3. 数据安全

- 定期备份数据库
- 加密敏感数据
- 限制访问权限
- 监控数据访问

## 📊 监控和维护

### 1. 系统监控

```bash
# 检查服务状态
ps aux | grep python

# 检查端口监听
netstat -tlnp | grep :5000

# 检查磁盘使用
df -h

# 检查内存使用
free -h
```

### 2. 数据库维护

```bash
# 备份数据库
cp trading_system.db trading_system_backup_$(date +%Y%m%d).db

# 清理旧日志
find . -name "*.log" -mtime +7 -delete

# 优化数据库
sqlite3 trading_system.db "VACUUM;"
```

### 3. 性能优化

- 定期清理日志文件
- 优化数据库查询
- 使用连接池
- 启用缓存

## 📞 技术支持

### 联系方式

- **GitHub Issues**: 提交问题报告
- **邮箱**: 技术支持邮箱
- **文档**: 查看README.md

### 常见问题

1. **系统无法启动**
   - 检查Python版本
   - 验证依赖安装
   - 查看错误日志

2. **API连接失败**
   - 检查网络连接
   - 验证API Key
   - 确认权限设置

3. **交易执行失败**
   - 检查账户余额
   - 验证交易参数
   - 查看错误信息

---

**🎯 部署完成后，请务必：**
1. 测试所有功能
2. 配置安全设置
3. 设置监控告警
4. 定期备份数据
5. 更新系统文档
