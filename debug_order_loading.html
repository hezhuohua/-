<!DOCTYPE html>
<html lang="zh-CN">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>订单加载调试</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                margin: 20px;
                background: #1a1a1a;
                color: #fff;
            }

            .debug-panel {
                background: #2a2a2a;
                padding: 20px;
                border-radius: 8px;
                margin-bottom: 20px;
            }

            .test-button {
                background: #00f3ff;
                color: #000;
                border: none;
                padding: 10px 20px;
                border-radius: 4px;
                cursor: pointer;
                margin: 5px;
            }

            .test-button:hover {
                background: #00d4e0;
            }

            .result {
                background: #333;
                padding: 10px;
                border-radius: 4px;
                margin: 10px 0;
                white-space: pre-wrap;
            }

            .success {
                border-left: 4px solid #4CAF50;
            }

            .error {
                border-left: 4px solid #f44336;
            }

            .info {
                border-left: 4px solid #2196F3;
            }
        </style>
    </head>

    <body>
        <h1>🔧 订单加载调试工具</h1>

        <div class="debug-panel">
            <h2>配置检查</h2>
            <button class="test-button" onclick="checkConfig()">检查配置</button>
            <div id="configResult" class="result"></div>
        </div>

        <div class="debug-panel">
            <h2>API测试</h2>
            <button class="test-button" onclick="testManualOrders()">测试手动订单API</button>
            <button class="test-button" onclick="testQuantifiedOrders()">测试量化订单API</button>
            <div id="apiResult" class="result"></div>
        </div>

        <div class="debug-panel">
            <h2>网络请求</h2>
            <button class="test-button" onclick="testNetworkRequests()">测试网络请求</button>
            <div id="networkResult" class="result"></div>
        </div>

        <script>
            // 模拟tradingApiConfig
            let tradingApiConfig = {
                apiKey: '',
                apiSecret: '',
                testnet: true,
                connected: false,
                userId: 'test_user_001'
            };

            function log(message, type = 'info') {
                const resultDiv = document.getElementById(type + 'Result');
                const timestamp = new Date().toLocaleTimeString();
                resultDiv.innerHTML += `[${timestamp}] ${message}\n`;
                resultDiv.scrollTop = resultDiv.scrollHeight;
            }

            function checkConfig() {
                log('=== 配置检查 ===', 'config');
                log(`用户ID: ${tradingApiConfig.userId}`, 'config');
                log(`API Key: ${tradingApiConfig.apiKey ? '已设置' : '未设置'}`, 'config');
                log(`API Secret: ${tradingApiConfig.apiSecret ? '已设置' : '未设置'}`, 'config');
                log(`测试网: ${tradingApiConfig.testnet}`, 'config');
                log(`连接状态: ${tradingApiConfig.connected}`, 'config');
            }

            async function testManualOrders() {
                log('=== 测试手动订单API ===', 'api');
                try {
                    const response = await fetch(`/api/manual-orders/${tradingApiConfig.userId}?limit=10&status=all`);
                    log(`HTTP状态: ${response.status} ${response.statusText}`, 'api');

                    if (response.ok) {
                        const result = await response.json();
                        log(`响应成功: ${JSON.stringify(result, null, 2)}`, 'api');
                    } else {
                        log(`响应失败: ${response.statusText}`, 'api');
                    }
                } catch (error) {
                    log(`请求异常: ${error.message}`, 'api');
                }
            }

            async function testQuantifiedOrders() {
                log('=== 测试量化订单API ===', 'api');
                try {
                    const response = await fetch(`/api/quantified-orders/${tradingApiConfig.userId}?limit=10&status=all`);
                    log(`HTTP状态: ${response.status} ${response.statusText}`, 'api');

                    if (response.ok) {
                        const result = await response.json();
                        log(`响应成功: ${JSON.stringify(result, null, 2)}`, 'api');
                    } else {
                        log(`响应失败: ${response.statusText}`, 'api');
                    }
                } catch (error) {
                    log(`请求异常: ${error.message}`, 'api');
                }
            }

            async function testNetworkRequests() {
                log('=== 测试网络请求 ===', 'network');

                // 测试服务器连接
                try {
                    const response = await fetch('/');
                    log(`服务器连接: ${response.status} ${response.statusText}`, 'network');
                } catch (error) {
                    log(`服务器连接失败: ${error.message}`, 'network');
                }

                // 测试API端点
                const endpoints = [
                    '/api/manual-orders/test_user_001',
                    '/api/quantified-orders/test_user_001',
                    '/api/manual-orders/default',
                    '/api/quantified-orders/default'
                ];

                for (const endpoint of endpoints) {
                    try {
                        const response = await fetch(endpoint);
                        log(`${endpoint}: ${response.status} ${response.statusText}`, 'network');
                    } catch (error) {
                        log(`${endpoint}: 请求失败 - ${error.message}`, 'network');
                    }
                }
            }

            // 页面加载时自动检查配置
            window.onload = function () {
                checkConfig();
            };
        </script>
    </body>

</html>
