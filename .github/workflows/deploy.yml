name: 🚀 自动部署永续合约预测系统

on:
  push:
    branches: [ master, main ]
  pull_request:
    branches: [ master, main ]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: 📥 检出代码
      uses: actions/checkout@v4

    - name: 📦 设置Node.js环境
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'

    - name: 🔧 安装依赖
      run: |
        npm install -g http-server
        npm install

    - name: 🧪 运行测试
      run: |
        echo "运行系统测试..."
        # 这里可以添加自动化测试

    - name: 📋 生成部署报告
      run: |
        echo "=== 部署报告 ===" > deploy-report.txt
        echo "部署时间: $(date)" >> deploy-report.txt
        echo "分支: ${{ github.ref }}" >> deploy-report.txt
        echo "提交: ${{ github.sha }}" >> deploy-report.txt
        echo "作者: ${{ github.actor }}" >> deploy-report.txt

    - name: 🚀 部署到GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      if: github.ref == 'refs/heads/master'
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: .
        publish_branch: gh-pages

    - name: 📧 发送部署通知
      if: always()
      run: |
        echo "部署状态: ${{ job.status }}"
        echo "查看部署结果: https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}"

    - name: 🎯 部署完成
      if: success()
      run: |
        echo "✅ 部署成功完成！"
        echo "🌐 访问地址: https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}"
        echo "📊 部署状态: https://github.com/${{ github.repository }}/actions"
