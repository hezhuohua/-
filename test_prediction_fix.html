<!DOCTYPE html>
<html lang="zh-CN">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>é¢„æµ‹åŠŸèƒ½ä¿®å¤æµ‹è¯•</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                max-width: 800px;
                margin: 0 auto;
                padding: 20px;
                background: #f5f5f5;
            }

            .test-section {
                background: white;
                padding: 20px;
                margin: 20px 0;
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }

            .status {
                padding: 10px;
                margin: 10px 0;
                border-radius: 4px;
                font-weight: bold;
            }

            .status.success {
                background: #d4edda;
                color: #155724;
            }

            .status.error {
                background: #f8d7da;
                color: #721c24;
            }

            .status.warning {
                background: #fff3cd;
                color: #856404;
            }

            .btn {
                padding: 10px 20px;
                margin: 5px;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                font-size: 16px;
            }

            .btn-primary {
                background: #007bff;
                color: white;
            }

            .btn-danger {
                background: #dc3545;
                color: white;
            }

            .btn-success {
                background: #28a745;
                color: white;
            }

            .log {
                background: #f8f9fa;
                border: 1px solid #dee2e6;
                padding: 10px;
                margin: 10px 0;
                border-radius: 4px;
                font-family: monospace;
                max-height: 300px;
                overflow-y: auto;
            }
        </style>
    </head>

    <body>
        <h1>ğŸ”§ é¢„æµ‹åŠŸèƒ½ä¿®å¤æµ‹è¯•</h1>

        <div class="test-section">
            <h2>ğŸ“Š å½“å‰çŠ¶æ€</h2>
            <div id="status" class="status warning">æ­£åœ¨æ£€æµ‹ç³»ç»ŸçŠ¶æ€...</div>
            <div>
                <strong>é¢„æµ‹çŠ¶æ€:</strong> <span id="predictingStatus">æ£€æµ‹ä¸­...</span><br>
                <strong>å®šæ—¶å™¨çŠ¶æ€:</strong> <span id="timerStatus">æ£€æµ‹ä¸­...</span><br>
                <strong>é¢„æµ‹æ•°æ®:</strong> <span id="dataStatus">æ£€æµ‹ä¸­...</span>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ§ª æµ‹è¯•åŠŸèƒ½</h2>
            <button class="btn btn-primary" onclick="testPrediction()">æµ‹è¯•é¢„æµ‹åŠŸèƒ½</button>
            <button class="btn btn-danger" onclick="forceReset()">å¼ºåˆ¶é‡ç½®çŠ¶æ€</button>
            <button class="btn btn-success" onclick="checkStatus()">æ£€æŸ¥çŠ¶æ€</button>
        </div>

        <div class="test-section">
            <h2>ğŸ“ æ“ä½œæ—¥å¿—</h2>
            <div id="log" class="log"></div>
            <button class="btn btn-primary" onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
        </div>

        <script>
            // æ¨¡æ‹ŸVueç»„ä»¶çš„çŠ¶æ€
            let systemState = {
                predicting: false,
                predictionTimer: null,
                currentPredictionData: null,
                showPredictionResult: false,
                predictionResult: null
            };

            // æ—¥å¿—åŠŸèƒ½
            function log(message, type = 'info') {
                const logDiv = document.getElementById('log');
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = document.createElement('div');
                logEntry.innerHTML = `<span style="color: #666;">[${timestamp}]</span> ${message}`;
                logDiv.appendChild(logEntry);
                logDiv.scrollTop = logDiv.scrollHeight;
            }

            function clearLog() {
                document.getElementById('log').innerHTML = '';
            }

            // çŠ¶æ€æ£€æŸ¥
            function checkStatus() {
                log('ğŸ” æ£€æŸ¥ç³»ç»ŸçŠ¶æ€...');

                const status = {
                    predicting: systemState.predicting,
                    predictionTimer: systemState.predictionTimer,
                    currentPredictionData: systemState.currentPredictionData,
                    showPredictionResult: systemState.showPredictionResult,
                    predictionResult: systemState.predictionResult
                };

                log(`ğŸ“Š å½“å‰çŠ¶æ€: ${JSON.stringify(status, null, 2)}`);

                // æ›´æ–°æ˜¾ç¤º
                document.getElementById('predictingStatus').textContent = systemState.predicting ? 'é¢„æµ‹ä¸­...' : 'ç©ºé—²';
                document.getElementById('timerStatus').textContent = systemState.predictionTimer ? 'è¿è¡Œä¸­' : 'æœªè¿è¡Œ';
                document.getElementById('dataStatus').textContent = systemState.currentPredictionData ? 'æœ‰æ•°æ®' : 'æ— æ•°æ®';

                // æ£€æŸ¥å¼‚å¸¸çŠ¶æ€
                if (systemState.predicting && !systemState.currentPredictionData) {
                    document.getElementById('status').className = 'status error';
                    document.getElementById('status').textContent = 'âš ï¸ æ£€æµ‹åˆ°å¼‚å¸¸çŠ¶æ€ï¼šé¢„æµ‹ä¸­ä½†æ— æ•°æ®';
                    log('âš ï¸ æ£€æµ‹åˆ°å¼‚å¸¸çŠ¶æ€ï¼šé¢„æµ‹ä¸­ä½†æ— æ•°æ®', 'error');
                } else if (systemState.predicting) {
                    document.getElementById('status').className = 'status warning';
                    document.getElementById('status').textContent = 'ğŸ”„ ç³»ç»Ÿæ­£åœ¨é¢„æµ‹ä¸­...';
                    log('ğŸ”„ ç³»ç»Ÿæ­£åœ¨é¢„æµ‹ä¸­...', 'warning');
                } else {
                    document.getElementById('status').className = 'status success';
                    document.getElementById('status').textContent = 'âœ… ç³»ç»ŸçŠ¶æ€æ­£å¸¸';
                    log('âœ… ç³»ç»ŸçŠ¶æ€æ­£å¸¸', 'success');
                }
            }

            // æµ‹è¯•é¢„æµ‹åŠŸèƒ½
            function testPrediction() {
                log('ğŸš€ å¼€å§‹æµ‹è¯•é¢„æµ‹åŠŸèƒ½...');

                if (systemState.predicting) {
                    log('âš ï¸ ç³»ç»Ÿæ­£åœ¨é¢„æµ‹ä¸­ï¼Œæ— æ³•å¯åŠ¨æ–°é¢„æµ‹', 'warning');
                    return;
                }

                // æ¨¡æ‹Ÿé¢„æµ‹è¿‡ç¨‹
                systemState.predicting = true;
                log('ğŸ“ˆ è®¾ç½®é¢„æµ‹çŠ¶æ€ä¸º: true');

                // æ¨¡æ‹Ÿé¢„æµ‹æ•°æ®
                systemState.currentPredictionData = {
                    symbol: 'BTCUSDT',
                    startTime: Date.now(),
                    predictions: {}
                };
                log('ğŸ“Š åˆ›å»ºé¢„æµ‹æ•°æ®');

                // æ¨¡æ‹Ÿå®šæ—¶å™¨
                systemState.predictionTimer = setTimeout(() => {
                    log('â° é¢„æµ‹å®šæ—¶å™¨åˆ°æœŸï¼Œæ¨¡æ‹Ÿé¢„æµ‹å®Œæˆ');
                    systemState.predicting = false;
                    systemState.currentPredictionData = null;
                    systemState.predictionTimer = null;
                    log('âœ… é¢„æµ‹å®Œæˆï¼ŒçŠ¶æ€å·²é‡ç½®');
                    checkStatus();
                }, 5000); // 5ç§’åå®Œæˆ

                log('â±ï¸ å¯åŠ¨é¢„æµ‹å®šæ—¶å™¨ (5ç§’)');
                checkStatus();
            }

            // å¼ºåˆ¶é‡ç½®çŠ¶æ€
            function forceReset() {
                log('ğŸ”„ æ‰§è¡Œå¼ºåˆ¶é‡ç½®...');

                // æ¸…ç†å®šæ—¶å™¨
                if (systemState.predictionTimer) {
                    clearTimeout(systemState.predictionTimer);
                    systemState.predictionTimer = null;
                    log('ğŸ§¹ æ¸…ç†é¢„æµ‹å®šæ—¶å™¨');
                }

                // é‡ç½®æ‰€æœ‰çŠ¶æ€
                systemState.predicting = false;
                systemState.currentPredictionData = null;
                systemState.showPredictionResult = false;
                systemState.predictionResult = null;

                log('âœ… æ‰€æœ‰çŠ¶æ€å·²é‡ç½®');
                checkStatus();
            }

            // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥çŠ¶æ€
            window.onload = function () {
                log('ğŸš€ é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹ç³»ç»Ÿæ£€æµ‹...');
                checkStatus();
            };

            // å®šæœŸæ£€æŸ¥çŠ¶æ€
            setInterval(checkStatus, 10000); // æ¯10ç§’æ£€æŸ¥ä¸€æ¬¡
        </script>
    </body>

</html>
